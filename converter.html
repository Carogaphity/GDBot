<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GD In a Bot Level Editor</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
    }
    .grid-container {
      display: grid;
      grid-template-columns: repeat(20, 30px);
      grid-template-rows: repeat(10, 30px);
      gap: 1px;
      position: relative;
      border: 1px solid #333;
      resize: both;
      overflow: hidden;
    }

    .grid-item {
      width: 30px;
      height: 30px;
      background-color: #55acee;
      border: 1px solid #ccc;
    }

    .sprite {
      width: 100%;
      height: 100%;
      background-size: contain;
      background-repeat: no-repeat;
    }

    .toolbar {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 50px;
      background-color: #333;
      color: #fff;
    }

    .toolbar button {
      margin: 0 5px;
      padding: 5px 10px;
      background-color: #666;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      color: white;
    }

    .toolbar button.selected {
      background-color: #888;
    }

    .export-container {
      margin-top: 20px;
      padding: 10px;
      border: 1px solid #ccc;
      background-color: #f9f9f9;
    }
  </style>
</head>
<body>

<div class="grid-container" id="grid">
  <!-- Grid items will be generated dynamically using JavaScript -->
</div>

<div class="toolbar">
  <button onclick="selectSprite('block')" id="blockBtn">Block</button>
  <button onclick="selectSprite('spike')" id="spikeBtn">Spike</button>
  <button onclick="selectSprite('ball_portal')" id="ballBtn">Ball Portal</button>
  <button onclick="selectSprite('wave_portal')" id="waveBtn">Wave Portal</button>
  <button onclick="selectSprite('cube_portal')" id="cubeBtn">Cube Portal</button>
  <button onclick="selectSprite('finish')" id="finishBtn">Finish</button>
  <button onclick="selectSprite('player')" id="playerBtn">Player</button>
  <button onclick="activateRectangleTool()" id="rectangleBtn">Rectangle Tool</button>
  <button onclick="selectSprite('air')" id="airBtn">Air</button>
  <button onclick="exportLevel()">Export</button>
  <button onclick="cleargrid()">Clear</button>
</div>

<div class="export-container" id="exportContainer"></div>

<script>
  let selectedSprite = null;
  let rectangleToolActive = false;
  let firstClickIndex = null;

  // Create the grid dynamically
  const gridContainer = document.getElementById('grid');
  let gridColumns = 20;
  let gridRows = 10;

  function createGrid(columns, rows) {
    gridContainer.style.gridTemplateColumns = `repeat(${columns}, 30px)`;
    gridContainer.style.gridTemplateRows = `repeat(${rows}, 30px)`;
    gridContainer.innerHTML = ''; // Clear existing grid

    for (let i = 0; i < columns * rows; i++) {
      const gridItem = document.createElement('div');
      gridItem.className = 'grid-item';
      gridItem.setAttribute('data-index', i);
      gridItem.addEventListener('click', handleGridItemClick);
      gridContainer.appendChild(gridItem);
    }
  }

  createGrid(gridColumns, gridRows);

  // Handle grid item click event
  function handleGridItemClick(event) {
    const gridItem = event.target;
    const selectedIndex = parseInt(gridItem.getAttribute('data-index'));

    if (rectangleToolActive) {
      if (firstClickIndex === null) {
        firstClickIndex = selectedIndex;
      } else {
        fillRectangle(firstClickIndex, selectedIndex);
        firstClickIndex = null;
        rectangleToolActive = false;
        resetButtonStyles();
      }
    } else if (selectedSprite) {
      if (selectedSprite === 'air') {
        gridItem.innerHTML = ''; // Clear the sprite
      } else {
        addSprite(gridItem, selectedSprite);
      }
    }
  }

  // Set selected sprite
  function selectSprite(spriteType) {
    selectedSprite = spriteType;
    resetButtonStyles();
    document.getElementById(`${spriteType}Btn`).classList.add('selected');
    if (rectangleToolActive) {
      document.getElementById('rectangleBtn').classList.add('selected');
    }
  }

  function activateRectangleTool() {
    rectangleToolActive = true;
    firstClickIndex = null; // Reset first click index
    resetButtonStyles();
    document.getElementById('rectangleBtn').classList.add('selected');
    if (selectedSprite) {
      document.getElementById(`${selectedSprite}Btn`).classList.add('selected');
    }
  }

  function addSprite(gridItem, spriteType) {
    const sprite = document.createElement('div');
    sprite.className = 'sprite';
    sprite.style.backgroundImage = `url('${getSpriteUrl(spriteType)}')`;
    gridItem.innerHTML = '';
    gridItem.appendChild(sprite);
  }

  function fillRectangle(startIndex, endIndex) {
    const minIndex = Math.min(startIndex, endIndex);
    const maxIndex = Math.max(startIndex, endIndex);
    const gridItems = document.querySelectorAll('.grid-item');

    const startRow = Math.floor(minIndex / gridColumns);
    const endRow = Math.floor(maxIndex / gridColumns);

    const startCol = minIndex % gridColumns;
    const endCol = maxIndex % gridColumns;

    for (let row = startRow; row <= endRow; row++) {
      for (let col = startCol; col <= endCol; col++) {
        const index = row * gridColumns + col;
        addSprite(gridItems[index], selectedSprite);
      }
    }
  }

  function exportLevel() {
    const gridItems = document.querySelectorAll('.grid-item');
    let levelText = '';

    gridItems.forEach((item, index) => {
      const sprite = item.querySelector('.sprite');
      levelText += sprite ? getSpriteKey(sprite.style.backgroundImage) : '.';

      if ((index + 1) % gridColumns === 0) {
        levelText += '\n';
      }
    });

    const blob = new Blob([levelText], { type: 'text/plain' });
    const downloadLink = document.createElement('a');
    downloadLink.href = URL.createObjectURL(blob);
    downloadLink.download = 'level.txt';
    downloadLink.click();
  }

  function cleargrid() {
    const gridItems = document.querySelectorAll('.grid-item');
    gridItems.forEach(item => item.innerHTML = '');
  }

  function resetButtonStyles() {
    const buttons = document.querySelectorAll('.toolbar button');
    buttons.forEach(button => button.classList.remove('selected'));
  }

  function getSpriteUrl(spriteType) {
    switch (spriteType) {
      case 'block':
        return 'https://raw.githubusercontent.com/Carogaphity/GDBot/refs/heads/pycord-port/assets/block.png';
      case 'air':
        return '';
      default:
        return 'https://via.placeholder.com/30'; // Placeholder URL
    }
  }

  function getSpriteKey(backgroundImage) {
    switch (backgroundImage) {
      case 'url("https://raw.githubusercontent.com/Carogaphity/GDBot/refs/heads/pycord-port/assets/block.png")':
        return '-';
      default:
        return null;
    }
  }

  let isResizing = false;
  gridContainer.addEventListener('mousedown', (e) => {
    if (e.offsetX > gridContainer.offsetWidth - 10 || e.offsetY > gridContainer.offsetHeight - 10) {
      isResizing = true;
    }
  });

  document.addEventListener('mousemove', (e) => {
    if (isResizing) {
      let newColumns = Math.max(1, Math.round(e.clientX / 30));
      let newRows = Math.max(1, Math.round(e.clientY / 30));
      if (newColumns !== gridColumns || newRows !== gridRows) {
        gridColumns = newColumns;
        gridRows = newRows;
        createGrid(gridColumns, gridRows);
      }
    }
  });

  document.addEventListener('mouseup', () => {
    isResizing = false;
  });
</script>

</body>
</html>
